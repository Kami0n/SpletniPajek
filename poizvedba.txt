WITH t (id_from, url_from, id_to, url_to) AS (
	SELECT pageFrom.id, pageFrom.url, pageTo.id, pageTo.url
	FROM crawldb.link
	INNER JOIN crawldb.page pageFrom ON pageFrom.id = crawldb.link.from_page
	INNER JOIN crawldb.page pageTo ON pageTo.id = crawldb.link.to_page
	WHERE pageFrom.id IN
		(SELECT from_page FROM
			(SELECT from_page,COUNT(*)
			FROM crawldb.link
			GROUP BY from_page
			ORDER BY COUNT(*) DESC
			LIMIT 30) aa)
)
SELECT json_agg(t) FROM t


